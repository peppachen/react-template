### 高阶组件（Higher-Order Component, HOC）

高阶组件是 React 中一种**设计模式**，通过接受一个组件作为输入，并返回一个新的增强组件。它主要用于逻辑复用，例如权限控制、数据注入、状态管理等。

### HOC 的定义

高阶组件本质上是一个函数：

```javascript
/*
* WrappedComponent：要被增强的原始组件。
* withEnhancement：高阶组件函数，返回一个新的组件。
* props：透传给原始组件的属性。
*/
const withEnhancement = (WrappedComponent) => {
  return (props) => {
    // 增强逻辑
    return <WrappedComponent {...props} />;
  };
};

```

### HOC 的核心特性

1. **纯函数**：HOC 不修改原组件，而是创建一个新组件并返回。
2. **可复用性**：通过 HOC，可以在多个组件中复用逻辑。
3. **不影响组件层次**：HOC 包装后不会破坏组件层级，仍然可以与其他组件协同工作。

### 使用场景

1. **注入额外的属性**

动态向组件传递额外的数据或方法。

2. **逻辑复用**

例如权限校验、数据预处理、状态共享等。

3. **条件渲染**

控制组件是否渲染。

### 创建高阶组件的步骤

#### 1. 注入额外属性

```tsx
const withExtraProps = (WrappedComponent) => {
  return (props) => {
    const extraProps = { user: 'John Doe', isLoggedIn: true };
    return <WrappedComponent {...props} {...extraProps} />;
  };
};

// 使用 HOC
const MyComponent = (props) => {
  return (
    <div>
      <p>User: {props.user}</p>
      <p>Logged In: {props.isLoggedIn ? 'Yes' : 'No'}</p>
    </div>
  );
};

const EnhancedComponent = withExtraProps(MyComponent);

// 渲染 EnhancedComponent
<EnhancedComponent />;
```

#### 2. 增强生命周期方法

```tsx
const withLogger = (WrappedComponent) => {
  return class extends React.Component {
    componentDidMount() {
      console.log(`Component ${WrappedComponent.name} mounted`);
    }

    render() {
      return <WrappedComponent {...this.props} />;
    }
  };
};

// 使用
const MyComponent = () => <div>My Component</div>;
const EnhancedComponent = withLogger(MyComponent);
<EnhancedComponent />;
```

#### 3. 条件渲染

```tsx
const withAuth = (WrappedComponent) => {
  return (props) => {
    const isAuthenticated = props.isLoggedIn; // 假设从 props 获取
    if (!isAuthenticated) {
      return <div>Please log in</div>;
    }
    return <WrappedComponent {...props} />;
  };
};

// 使用
const Dashboard = () => <div>Welcome to the dashboard!</div>;
const ProtectedDashboard = withAuth(Dashboard);

<ProtectedDashboard isLoggedIn={true} />;
```

