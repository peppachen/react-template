## 什么是 Fiber 架构？

Fiber 是 React 16 引入的**一种新的协调引擎**，用于**提高渲染性能**。它是**基于时间分片（Time Slicing）的一种增量更新架构**，可以将渲染**任务拆分**为更小的单元，并在**需要时中断和恢复渲染**。

## 为什么需要 Fiber 架构？

### 1. 解决长任务阻塞：

传统 React 的更新是同步的，任务执行过程中无法中断，可能导致主线程阻塞，造成界面卡顿。

### 2. 任务优先级调度：

不同类型的任务（如用户输入、动画、后台更新）需要被分配优先级，保证更重要的任务优先完成。

### 3.用户体验提升：

让 React 渲染过程更加灵活，减少卡顿，增强交互体验。

## Fiber 架构的核心特点

### 1. 时间分片（Time Slicing）：

将渲染任务拆分为更小的任务单元，并在主线程空闲时间执行，避免阻塞。

### 2. 可中断和恢复：

渲染任务可以中途暂停以处理更高优先级任务，稍后恢复，保持流畅性。

### 3. 任务优先级调度：

根据任务重要性（如用户输入 vs 后台更新）动态调整执行顺序。

### 4. 双缓存机制：

React 同时维护两棵 Fiber 树：

- **Current Fiber Tree（当前树）**：已渲染到屏幕的状态。

- **Work In Progress Fiber Tree（工作树）**：正在更新的树，完成后替换当前树。

## Fiber 的调度流程

### 1. 任务拆分：

将更新拆分为多个小任务。

### 2. 调度优先级：

 使用 scheduler 或 requestIdleCallback 确定任务执行顺序。

### 3. 任务执行：

利用主线程的空闲时间逐步执行任务。

### 4. 任务提交：

所有任务完成后，更新 DOM。

## Fiber 带来的优势

### 1. 流畅的用户体验：

高优先级任务（如用户输入）可以优先完成，避免界面卡顿。

### 2. 灵活的任务调度：

支持任务中断、恢复、取消等操作。

### 3. 支持新特性：

Fiber 是实现 **Concurrent Mode（并发模式）** 和 **Suspense** 的基础，帮助 React 支持异步渲染和流式加载。
